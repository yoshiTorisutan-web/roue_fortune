<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Roue de la Fortune</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* PAGE DE CONNEXION */
      .login-page {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
      }

      .login-card {
        background: white;
        border-radius: 30px;
        padding: 60px 50px;
        box-shadow: 0 30px 80px rgba(0, 0, 0, 0.3);
        max-width: 450px;
        width: 100%;
        text-align: center;
      }

      .logo {
        font-size: 4em;
        margin-bottom: 20px;
      }

      .login-card h1 {
        color: #667eea;
        margin-bottom: 15px;
        font-size: 2.2em;
      }

      .login-card p {
        color: #666;
        margin-bottom: 40px;
        font-size: 1.1em;
      }

      .input-group {
        margin-bottom: 25px;
        text-align: left;
      }

      .input-group label {
        display: block;
        color: #333;
        font-weight: 600;
        margin-bottom: 10px;
        font-size: 0.95em;
      }

      .input-group input {
        width: 100%;
        padding: 15px 20px;
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        font-size: 1em;
        transition: all 0.3s;
        outline: none;
      }

      .input-group input:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .login-btn {
        width: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 18px;
        font-size: 1.2em;
        font-weight: 600;
        border-radius: 12px;
        cursor: pointer;
        transition:
          transform 0.2s,
          box-shadow 0.2s;
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
      }

      .login-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 35px rgba(102, 126, 234, 0.5);
      }

      /* NAVIGATION */
      .navbar {
        background: rgba(255, 255, 255, 0.95);
        padding: 20px 0;
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 50;
        backdrop-filter: blur(10px);
      }

      .nav-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .nav-logo {
        font-size: 1.8em;
        font-weight: bold;
        color: #667eea;
      }

      .nav-user {
        display: flex;
        gap: 20px;
        align-items: center;
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 12px;
        background: #f8f9fa;
        padding: 10px 20px;
        border-radius: 25px;
      }

      .user-avatar {
        width: 35px;
        height: 35px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
      }

      .nav-btn {
        background: transparent;
        border: 2px solid #667eea;
        color: #667eea;
        padding: 10px 25px;
        border-radius: 25px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
      }

      .nav-btn:hover {
        background: #667eea;
        color: white;
      }

      .nav-btn.active {
        background: #667eea;
        color: white;
      }

      .logout-btn {
        background: #ff4757;
        border: none;
        color: white;
        padding: 10px 25px;
        border-radius: 25px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
      }

      .logout-btn:hover {
        background: #ff3838;
        transform: translateY(-2px);
      }

      /* PAGE DE JEU */
      .game-page {
        max-width: 1400px;
        margin: 0 auto;
        padding: 50px 30px;
      }

      .game-container {
        display: grid;
        grid-template-columns: 1fr 400px;
        gap: 40px;
      }

      .wheel-section {
        background: white;
        border-radius: 30px;
        padding: 50px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
      }

      .wheel-header {
        text-align: center;
        margin-bottom: 50px;
      }

      .wheel-header h1 {
        color: #667eea;
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      .wheel-header p {
        color: #666;
        font-size: 1.1em;
      }

      .wheel-container {
        position: relative;
        width: 450px;
        height: 450px;
        margin: 0 auto 50px;
      }

      .wheel {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        border: 15px solid #333;
        position: relative;
        transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
      }

      .arrow {
        position: absolute;
        top: -35px;
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 25px solid transparent;
        border-right: 25px solid transparent;
        border-top: 50px solid #ff4757;
        z-index: 10;
        filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.3));
      }

      .center-circle {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 50%;
        z-index: 5;
        border: 6px solid white;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
      }

      .spin-controls {
        text-align: center;
      }

      .spin-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 20px 60px;
        font-size: 1.3em;
        font-weight: 600;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
      }

      .spin-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5);
      }

      .spin-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: translateY(0);
      }

      .sidebar {
        display: flex;
        flex-direction: column;
        gap: 30px;
      }

      .stats-card {
        background: white;
        border-radius: 25px;
        padding: 30px;
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
      }

      .stats-card h2 {
        color: #667eea;
        margin-bottom: 25px;
        font-size: 1.5em;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .stat-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: #f8f9fa;
        border-radius: 15px;
        margin-bottom: 12px;
      }

      .stat-label {
        font-weight: 600;
        color: #333;
      }

      .stat-value {
        font-size: 1.3em;
        font-weight: bold;
        color: #667eea;
      }

      .history-card {
        background: white;
        border-radius: 25px;
        padding: 30px;
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
        max-height: 500px;
        overflow-y: auto;
      }

      .history-card h2 {
        color: #667eea;
        margin-bottom: 25px;
        font-size: 1.5em;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .history-item {
        padding: 18px 20px;
        margin-bottom: 12px;
        border-radius: 15px;
        transition: transform 0.2s;
      }

      .history-item:hover {
        transform: translateX(5px);
      }

      .history-item.win {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        border-left: 5px solid #28a745;
      }

      .history-item.lose {
        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        border-left: 5px solid #dc3545;
      }

      .history-item.retry {
        background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
        border-left: 5px solid #ffc107;
      }

      .history-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .history-prize {
        font-weight: 600;
        font-size: 1em;
      }

      .history-time {
        font-size: 0.85em;
        color: #666;
      }

      /* PAGE STATISTIQUES */
      .stats-page {
        max-width: 1400px;
        margin: 0 auto;
        padding: 50px 30px;
      }

      .stats-page h1 {
        color: white;
        text-align: center;
        font-size: 3em;
        margin-bottom: 50px;
        text-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .players-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 30px;
      }

      .player-card {
        background: white;
        border-radius: 25px;
        padding: 35px;
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        transition:
          transform 0.3s,
          box-shadow 0.3s;
      }

      .player-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 25px 60px rgba(0, 0, 0, 0.25);
      }

      .player-header {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 30px;
        padding-bottom: 25px;
        border-bottom: 3px solid #f0f0f0;
      }

      .player-avatar-large {
        width: 70px;
        height: 70px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 1.8em;
        box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
      }

      .player-info h3 {
        color: #333;
        font-size: 1.5em;
        margin-bottom: 5px;
      }

      .player-info p {
        color: #666;
        font-size: 0.95em;
      }

      .player-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 25px;
      }

      .mini-stat {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 12px;
        text-align: center;
      }

      .mini-stat-label {
        color: #666;
        font-size: 0.85em;
        margin-bottom: 5px;
      }

      .mini-stat-value {
        color: #667eea;
        font-size: 1.8em;
        font-weight: bold;
      }

      .player-wins {
        background: #f0f8ff;
        padding: 20px;
        border-radius: 15px;
        border-left: 5px solid #28a745;
      }

      .player-wins h4 {
        color: #28a745;
        margin-bottom: 15px;
        font-size: 1.1em;
      }

      .win-item {
        background: white;
        padding: 12px 15px;
        border-radius: 10px;
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      .win-name {
        font-weight: 600;
        color: #333;
      }

      .win-time {
        font-size: 0.85em;
        color: #666;
      }

      /* OVERLAY ET POPUP */
      .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        z-index: 100;
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(5px);
      }

      .overlay.active {
        display: flex;
      }

      .result-popup {
        background: white;
        padding: 60px 50px;
        border-radius: 30px;
        text-align: center;
        max-width: 550px;
        width: 90%;
        animation: popIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        box-shadow: 0 30px 80px rgba(0, 0, 0, 0.5);
      }

      @keyframes popIn {
        from {
          transform: scale(0.3) rotate(-10deg);
          opacity: 0;
        }
        to {
          transform: scale(1) rotate(0deg);
          opacity: 1;
        }
      }

      .result-icon {
        font-size: 5em;
        margin-bottom: 20px;
      }

      .result-popup h2 {
        font-size: 2.5em;
        margin-bottom: 20px;
      }

      .result-popup p {
        font-size: 1.4em;
        margin-bottom: 40px;
        color: #666;
      }

      .close-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 18px 50px;
        font-size: 1.2em;
        font-weight: 600;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
      }

      .close-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5);
      }

      .confetti {
        position: fixed;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        animation: confetti-fall 3s linear;
        z-index: 1000;
      }

      @keyframes confetti-fall {
        to {
          transform: translateY(100vh) rotate(720deg);
          opacity: 0;
        }
      }

      .hidden {
        display: none !important;
      }

      /* RESPONSIVE */
      @media (max-width: 1200px) {
        .game-container {
          grid-template-columns: 1fr;
        }

        .sidebar {
          grid-template-columns: 1fr 1fr;
          grid-template-rows: auto;
        }
      }

      @media (max-width: 768px) {
        .wheel-container {
          width: 350px;
          height: 350px;
        }

        .sidebar {
          grid-template-columns: 1fr;
        }

        .players-grid {
          grid-template-columns: 1fr;
        }

        .nav-container {
          flex-direction: column;
          gap: 15px;
        }

        .login-card {
          padding: 40px 30px;
        }
      }
    </style>
  </head>
  <body>
    <!-- PAGE DE CONNEXION -->
    <div class="login-page" id="loginPage">
      <div class="login-card">
        <div class="logo">üé∞</div>
        <h1>Roue de la Fortune</h1>
        <p>Cr√©ez votre compte pour jouer et gagner des cadeaux !</p>

        <form id="loginForm">
          <div class="input-group">
            <label for="username">Nom d'utilisateur</label>
            <input
              type="text"
              id="username"
              placeholder="Entrez votre nom"
              required
            />
          </div>

          <button type="submit" class="login-btn">Commencer √† jouer üéÆ</button>
        </form>
      </div>
    </div>

    <!-- NAVIGATION -->
    <nav class="navbar hidden" id="navbar">
      <div class="nav-container">
        <div class="nav-logo">üé∞ Roue de la Fortune</div>
        <div class="nav-user">
          <button class="nav-btn active" id="gameBtn">üéÆ Jouer</button>
          <button class="nav-btn" id="statsBtn">üìä Statistiques</button>
          <div class="user-info">
            <div class="user-avatar" id="navAvatar"></div>
            <span id="navUsername"></span>
          </div>
          <button class="logout-btn" id="logoutBtn">D√©connexion</button>
        </div>
      </div>
    </nav>

    <!-- PAGE DE JEU -->
    <div class="game-page hidden" id="gamePage">
      <div class="game-container">
        <div class="wheel-section">
          <div class="wheel-header">
            <h1>üé∞ Tournez la Roue üé∞</h1>
            <p>Tentez votre chance et gagnez des cadeaux incroyables !</p>
          </div>

          <div class="wheel-container">
            <div class="arrow"></div>
            <canvas id="wheelCanvas" width="450" height="450"></canvas>
            <div class="center-circle"></div>
          </div>

          <div class="spin-controls">
            <button class="spin-btn" id="spinBtn">Tourner la roue ! üöÄ</button>
          </div>
        </div>

        <div class="sidebar">
          <div class="stats-card">
            <h2>üìà Vos statistiques</h2>
            <div class="stat-item">
              <span class="stat-label">Tours jou√©s</span>
              <span class="stat-value" id="totalSpins">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Victoires</span>
              <span class="stat-value" id="totalWins">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">D√©faites</span>
              <span class="stat-value" id="totalLosses">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Taux de r√©ussite</span>
              <span class="stat-value" id="winRate">0%</span>
            </div>
          </div>

          <div class="history-card">
            <h2>üìú Historique</h2>
            <div id="historyList">
              <p style="text-align: center; color: #999; padding: 20px">
                Aucun historique pour le moment
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- PAGE STATISTIQUES -->
    <div class="stats-page hidden" id="statsPage">
      <h1>üìä Statistiques des Joueurs</h1>
      <div class="players-grid" id="playersGrid"></div>
    </div>

    <!-- OVERLAY R√âSULTAT -->
    <div class="overlay" id="overlay">
      <div class="result-popup">
        <div class="result-icon" id="resultIcon"></div>
        <h2 id="resultTitle"></h2>
        <p id="resultText"></p>
        <button class="close-btn" id="closeBtn">Continuer</button>
      </div>
    </div>

    <script>
      const prizes = [
        { name: "iPhone 15 Pro", type: "win", color: "#ff6b6b" },
        { name: "Perdu", type: "lose", color: "#4a4a4a" },
        { name: "PlayStation 5", type: "win", color: "#4ecdc4" },
        { name: "Retenter", type: "retry", color: "#ffe66d" },
        { name: "Voyage √† Paris", type: "win", color: "#a8e6cf" },
        { name: "Perdu", type: "lose", color: "#4a4a4a" },
        { name: "MacBook Pro", type: "win", color: "#ff8b94" },
        { name: "Retenter", type: "retry", color: "#ffe66d" },
      ];

      let currentUser = null;
      let players = {};
      let spinning = false;

      // Charger les donn√©es du stockage
      function loadData() {
        const saved = localStorage.getItem("wheelGameData");
        if (saved) {
          const data = JSON.parse(saved);
          players = data.players || {};
        }
      }

      // Sauvegarder les donn√©es
      function saveData() {
        localStorage.setItem("wheelGameData", JSON.stringify({ players }));
      }

      // Connexion
      document.getElementById("loginForm").addEventListener("submit", (e) => {
        e.preventDefault();
        const username = document.getElementById("username").value.trim();

        if (!username) return;

        if (!players[username]) {
          players[username] = {
            name: username,
            spins: 0,
            wins: 0,
            losses: 0,
            history: [],
            prizes: [],
          };
        }

        currentUser = username;
        saveData();
        showGamePage();
      });

      function showGamePage() {
        document.getElementById("loginPage").classList.add("hidden");
        document.getElementById("navbar").classList.remove("hidden");
        document.getElementById("gamePage").classList.remove("hidden");
        document.getElementById("statsPage").classList.add("hidden");

        document.getElementById("navUsername").textContent = currentUser;
        document.getElementById("navAvatar").textContent =
          currentUser[0].toUpperCase();

        document.getElementById("gameBtn").classList.add("active");
        document.getElementById("statsBtn").classList.remove("active");

        updateStats();
        updateHistory();
        drawWheel();
      }

      function showStatsPage() {
        document.getElementById("gamePage").classList.add("hidden");
        document.getElementById("statsPage").classList.remove("hidden");

        document.getElementById("gameBtn").classList.remove("active");
        document.getElementById("statsBtn").classList.add("active");

        displayAllPlayers();
      }

      document
        .getElementById("gameBtn")
        .addEventListener("click", showGamePage);
      document
        .getElementById("statsBtn")
        .addEventListener("click", showStatsPage);

      document.getElementById("logoutBtn").addEventListener("click", () => {
        currentUser = null;
        document.getElementById("loginPage").classList.remove("hidden");
        document.getElementById("navbar").classList.add("hidden");
        document.getElementById("gamePage").classList.add("hidden");
        document.getElementById("statsPage").classList.add("hidden");
        document.getElementById("username").value = "";
      });

      // Dessiner la roue
      const canvas = document.getElementById("wheelCanvas");
      const ctx = canvas.getContext("2d");

      function drawWheel() {
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const radius = canvas.width / 2 - 20;
        const sliceAngle = (2 * Math.PI) / prizes.length;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        prizes.forEach((prize, i) => {
          const startAngle = i * sliceAngle - Math.PI / 2;
          const endAngle = startAngle + sliceAngle;

          ctx.beginPath();
          ctx.moveTo(centerX, centerY);
          ctx.arc(centerX, centerY, radius, startAngle, endAngle);
          ctx.closePath();
          ctx.fillStyle = prize.color;
          ctx.fill();
          ctx.strokeStyle = "#fff";
          ctx.lineWidth = 4;
          ctx.stroke();

          ctx.save();
          ctx.translate(centerX, centerY);
          ctx.rotate(startAngle + sliceAngle / 2);
          ctx.textAlign = "center";
          ctx.fillStyle = "#fff";
          ctx.font = "bold 16px Arial";
          ctx.shadowColor = "rgba(0,0,0,0.5)";
          ctx.shadowBlur = 5;
          ctx.fillText(prize.name, radius / 1.6, 5);
          ctx.restore();
        });
      }

      function getProbability() {
        const userData = players[currentUser];
        const baseWinChance = 0.25;
        const baseLoseChance = 0.3;
        const baseRetryChance = 0.45;
        const spinsModifier = Math.min(userData.spins * 0.02, 0.15);

        return {
          win: baseWinChance + spinsModifier,
          lose: baseLoseChance - spinsModifier * 0.5,
          retry: baseRetryChance - spinsModifier * 0.5,
        };
      }

      function selectPrize() {
        const prob = getProbability();
        const rand = Math.random();

        let selectedType;
        if (rand < prob.win) {
          selectedType = "win";
        } else if (rand < prob.win + prob.lose) {
          selectedType = "lose";
        } else {
          selectedType = "retry";
        }

        const typePrizes = prizes
          .map((p, i) => ({ ...p, index: i }))
          .filter((p) => p.type === selectedType);
        return typePrizes[Math.floor(Math.random() * typePrizes.length)];
      }

      function spinWheel() {
        if (spinning) return;
        spinning = true;
        document.getElementById("spinBtn").disabled = true;

        const selectedPrize = selectPrize();
        const sliceAngle = 360 / prizes.length;
        const targetAngle = selectedPrize.index * sliceAngle;
        const spins = 5;
        const finalAngle = spins * 360 + (360 - targetAngle) + sliceAngle / 2;

        canvas.style.transform = `rotate(${finalAngle}deg)`;

        setTimeout(() => {
          const userData = players[currentUser];
          userData.spins++;

          if (selectedPrize.type === "win") {
            userData.wins++;
            userData.prizes.push({
              name: selectedPrize.name,
              time: new Date().toLocaleString("fr-FR"),
            });
            createConfetti();
          } else if (selectedPrize.type === "lose") {
            userData.losses++;
          }

          userData.history.unshift({
            prize: selectedPrize.name,
            type: selectedPrize.type,
            time: new Date().toLocaleString("fr-FR"),
          });

          if (userData.history.length > 20) {
            userData.history = userData.history.slice(0, 20);
          }

          saveData();
          showResult(selectedPrize);
          updateStats();
          updateHistory();

          spinning = false;
          document.getElementById("spinBtn").disabled = false;
          canvas.style.transform = "rotate(0deg)";
          canvas.style.transition = "none";
          setTimeout(() => {
            canvas.style.transition =
              "transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99)";
          }, 50);
        }, 4000);
      }

      function showResult(prize) {
        document.getElementById("overlay").classList.add("active");

        if (prize.type === "win") {
          document.getElementById("resultIcon").textContent = "üéâ";
          document.getElementById("resultTitle").textContent =
            "F√âLICITATIONS !";
          document.getElementById("resultTitle").style.color = "#28a745";
          document.getElementById("resultText").textContent =
            `Vous avez gagn√© : ${prize.name}`;
        } else if (prize.type === "lose") {
          document.getElementById("resultIcon").textContent = "üò¢";
          document.getElementById("resultTitle").textContent = "Perdu...";
          document.getElementById("resultTitle").style.color = "#dc3545";
          document.getElementById("resultText").textContent =
            "Retentez votre chance !";
        } else {
          document.getElementById("resultIcon").textContent = "üîÑ";
          document.getElementById("resultTitle").textContent =
            "Nouvelle chance !";
          document.getElementById("resultTitle").style.color = "#ffc107";
          document.getElementById("resultText").textContent =
            "Vous pouvez retourner la roue !";
        }
      }

      function createConfetti() {
        const colors = [
          "#ff6b6b",
          "#4ecdc4",
          "#ffe66d",
          "#a8e6cf",
          "#ff8b94",
          "#95e1d3",
        ];
        for (let i = 0; i < 150; i++) {
          setTimeout(() => {
            const confetti = document.createElement("div");
            confetti.className = "confetti";
            confetti.style.left = Math.random() * 100 + "%";
            confetti.style.top = "-20px";
            confetti.style.background =
              colors[Math.floor(Math.random() * colors.length)];
            confetti.style.animationDelay = Math.random() * 0.3 + "s";
            confetti.style.animationDuration = Math.random() * 2 + 2 + "s";
            document.body.appendChild(confetti);

            setTimeout(() => confetti.remove(), 3500);
          }, i * 15);
        }
      }

      function updateStats() {
        const userData = players[currentUser];
        document.getElementById("totalSpins").textContent = userData.spins;
        document.getElementById("totalWins").textContent = userData.wins;
        document.getElementById("totalLosses").textContent = userData.losses;

        const winRate =
          userData.spins > 0
            ? Math.round((userData.wins / userData.spins) * 100)
            : 0;
        document.getElementById("winRate").textContent = winRate + "%";
      }

      function updateHistory() {
        const userData = players[currentUser];
        const historyList = document.getElementById("historyList");

        if (userData.history.length === 0) {
          historyList.innerHTML =
            '<p style="text-align: center; color: #999; padding: 20px;">Aucun historique pour le moment</p>';
          return;
        }

        historyList.innerHTML = userData.history
          .map(
            (item) => `
                <div class="history-item ${item.type}">
                    <div class="history-content">
                        <span class="history-prize">
                            ${item.type === "win" ? "üèÜ" : item.type === "lose" ? "‚ùå" : "üîÑ"} 
                            ${item.prize}
                        </span>
                        <span class="history-time">${item.time.split(" ")[1]}</span>
                    </div>
                </div>
            `,
          )
          .join("");
      }

      function displayAllPlayers() {
        const playersGrid = document.getElementById("playersGrid");
        const playersList = Object.values(players).sort(
          (a, b) => b.wins - a.wins,
        );

        if (playersList.length === 0) {
          playersGrid.innerHTML =
            '<p style="color: white; text-align: center; font-size: 1.2em;">Aucun joueur pour le moment</p>';
          return;
        }

        playersGrid.innerHTML = playersList
          .map((player) => {
            const winRate =
              player.spins > 0
                ? Math.round((player.wins / player.spins) * 100)
                : 0;

            const prizesHtml =
              player.prizes.length > 0
                ? player.prizes
                    .slice(0, 5)
                    .map(
                      (prize) => `
                        <div class="win-item">
                            <span class="win-name">üéÅ ${prize.name}</span>
                            <span class="win-time">${prize.time.split(" ")[1]}</span>
                        </div>
                    `,
                    )
                    .join("")
                : '<p style="text-align: center; color: #999; padding: 10px;">Aucun gain</p>';

            return `
                    <div class="player-card">
                        <div class="player-header">
                            <div class="player-avatar-large">${player.name[0].toUpperCase()}</div>
                            <div class="player-info">
                                <h3>${player.name}</h3>
                                <p>Membre depuis le ${new Date().toLocaleDateString("fr-FR")}</p>
                            </div>
                        </div>
                        
                        <div class="player-stats">
                            <div class="mini-stat">
                                <div class="mini-stat-label">Tours</div>
                                <div class="mini-stat-value">${player.spins}</div>
                            </div>
                            <div class="mini-stat">
                                <div class="mini-stat-label">Victoires</div>
                                <div class="mini-stat-value">${player.wins}</div>
                            </div>
                            <div class="mini-stat">
                                <div class="mini-stat-label">D√©faites</div>
                                <div class="mini-stat-value">${player.losses}</div>
                            </div>
                            <div class="mini-stat">
                                <div class="mini-stat-label">Taux</div>
                                <div class="mini-stat-value">${winRate}%</div>
                            </div>
                        </div>
                        
                        <div class="player-wins">
                            <h4>üèÜ Derniers gains (${player.prizes.length})</h4>
                            ${prizesHtml}
                        </div>
                    </div>
                `;
          })
          .join("");
      }

      document.getElementById("spinBtn").addEventListener("click", spinWheel);
      document.getElementById("closeBtn").addEventListener("click", () => {
        document.getElementById("overlay").classList.remove("active");
      });

      loadData();
    </script>
  </body>
</html>
